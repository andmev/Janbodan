---
description: General Rules for Project
globs: *.swift
---
# General Project Structure & Best Practices for Clever â€“ AI Chat Application  

**Act as:**  
A Swift architecture expert ensuring a **clean, scalable, and modular project structure** for a high-performance AI chat application.  

**Project Context:**  
Clever is a **cross-platform AI chat application** supporting **iOS, macOS, and visionOS** with multiple AI providers, speech recognition, and premium features.  

**Environment:**  
Xcode 16, Swift 6  

**Problem Statement:**  
A large, feature-rich SwiftUI project requires a **well-structured architecture** to ensure:  
- **Maintainability**: Clear separation of concerns  
- **Scalability**: Easy feature expansion  
- **Performance**: Efficient and optimized data flows  
- **Consistency**: Adherence to Appleâ€™s best practices  

**Attempted Solutions:**  
- Used a **flat folder structure**, but led to **code organization issues**.  
- Tried **grouping files by type**, but resulted in **tight coupling** of components.  
- Implemented **modular feature-based organization**, which improved maintainability.  

## **ğŸ“‚ Project Structure & Best Practices**  

### **ğŸ“ @App/**
Core app files, including entry points and global environment setup.  

#### **ğŸ“„ CleverApp.swift** (Main app entry point)  
âœ… Use `@main` to define the primary app structure.  
âœ… Configure **SwiftData** for persistence.  
âœ… Integrate **Sentry** for real-time error tracking.  
âœ… Set up **environment managers** (`AuthManager`, `StoreManager`, etc.).  
âœ… Use platform-specific window handling for **iOS, macOS, and visionOS**.  

#### **ğŸ“„ ContentView.swift** (Root container)  
âœ… Acts as the **main navigation hub**.  
âœ… Provides **environment objects** to subviews.  
âœ… Implements **navigation stack** for seamless app flow.  
âœ… Uses **adaptive UI elements** based on the platform.  

---

### **ğŸ“ @Factories/**
Handles **object creation and dependency injection** for modularity.  

#### **Factory Best Practices**  
âœ… Use **static factory methods** to encapsulate object initialization.  
âœ… Avoid **direct instantiation of objects** inside view models.  

#### **Key Factories:**  
- `ProviderFactoryManager`: Creates AI provider instances (**OpenAI, Anthropic, Google**).  
- `SpeechRecognitionFactory`: Instantiates speech services (**WhisperKit, Apple Speech**).  

---

### **ğŸ“ @Managers/**
Handles **business logic, data processing, and app state management**.  

#### **State & Logic Best Practices**  
âœ… Use **single responsibility principle** for each manager.  
âœ… Implement **`@Observable` and `@Bindable`** for state management.  
âœ… **No hardcoded dependencies**â€”use factory classes or dependency injection.  

#### **Key Managers:**  
- **Auth:** `AuthManager`, `AuthService`, `SecurityStorageManager` (handles authentication).  
- **Chat:** `ChatProcessingManager`, `StreamingManager` (manages chat interactions).  
- **Download:** `HubModelDownloadManager`, `WhisperKitManager` (handles model downloads).  
- **Providers:** `OpenAIManager`, `AnthropicManager`, `GoogleManager` (AI service implementations).  
- **Speech:** `SpeechRecognitionManager`, `WhisperKitManager` (speech recognition logic).  
- **Utility:** `HapticManager`, `ProviderConfigManager`, `StoreManager` (miscellaneous app utilities).  

---

### **ğŸ“ @Models/**
Defines **SwiftData models, migrations, and data structures**.  

#### **Data Model Best Practices**  
âœ… Use **SwiftData** for persistence instead of Core Data.  
âœ… Implement **versioned migrations** for schema updates.  
âœ… Separate **business logic from data models**.  

#### **Key Models:**  
- **Core Models:** `Chat`, `Message`, `Provider`, `Question`, `Service`.  
- **Migrations:** `SchemaV0`, `SchemaV1`, `MigrationPlan`.  
- **Type Definitions:** Enumerations and helper types.  

---

### **ğŸ“ @Protocols/**
Defines **interfaces for dependency injection and modularity**.  

#### **Protocol Best Practices**  
âœ… Use **protocols** to abstract functionality from concrete classes.  
âœ… Apply **protocol-oriented programming (POP)** principles.  
âœ… Avoid **overcomplicating** with unnecessary protocol hierarchies.  

#### **Key Protocols:**  
- `SpeechRecognitionProtocol`: Defines speech-to-text operations.  
- `TextClassifierProtocol`: Abstracts AI text classification logic.  

---

### **ğŸ“ @Views/**
SwiftUI views organized by feature and purpose.  

#### **View Best Practices**  
âœ… Follow **MVVM**â€”views should only handle UI logic.  
âœ… Use **preview providers** for testing.  
âœ… Implement **modular, reusable components**.  
âœ… Support **adaptive layouts** across iOS, macOS, and visionOS.  

#### **View Subfolders:**  
- **ğŸ“ Actions/** â†’ User interactions (buttons, inputs).  
- **ğŸ“ Chat/** â†’ Chat UI components.  
- **ğŸ“ CleverPro/** â†’ Premium feature screens.  
- **ğŸ“ Common/** â†’ Shared UI components (modals, alerts, loaders).  
- **ğŸ“ Settings/** â†’ User configuration screens.  
- **ğŸ“ Welcome/** â†’ Onboarding UI and first-time setup.  

---

## **Final Notes**  
By following this **structured project organization**, Clever ensures:  
âœ… **Scalability** â€“ Easy feature expansion with minimal refactoring.  
âœ… **Maintainability** â€“ Clear separation of concerns.  
âœ… **Performance** â€“ Efficient state management and modular logic.  
âœ… **Cross-Platform Support** â€“ Optimized for iOS, macOS, and visionOS.  

This structure follows **Appleâ€™s best practices** and ensures a high-performance, maintainable AI chat application. ğŸš€  
